<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
a.print { font-size: x-small; }

</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>openjfx Udiff modules/javafx.graphics/src/main/java/com/sun/glass/ui/Robot.java</title>

<style type="text/css" media="screen">
span.new {
    color: blue;
    font-weight: normal;
}
</style>

</head>
<body id="SUNWwebrev">
<center><a href='../../../../../../../../../modules/javafx.graphics/src/main/java/com/sun/glass/ui/Application.java.udiff.html' target='_top'>&lt prev</a> <a href='../../../../../../../../../index.html' target='_top'>index</a> <a href='../../../../../../../../../modules/javafx.graphics/src/main/java/com/sun/glass/ui/gtk/GtkApplication.java.udiff.html' target='_top'>next &gt</a></center>
<h2>modules/javafx.graphics/src/main/java/com/sun/glass/ui/Robot.java</h2>
        <a class="print" href="javascript:print()">Print this page</a>
<pre>rev <a href="https://bugs.openjdk.java.net/browse/JDK-10767">10767</a> : Move Robot to public API.</pre>
        <pre>
</pre><hr /><pre>
<span class="newmarker">@@ -1,271 +0,0 @@</span>
<span class="removed">-/*</span>
<span class="removed">- * Copyright (c) 2010, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="removed">- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<span class="removed">- *</span>
<span class="removed">- * This code is free software; you can redistribute it and/or modify it</span>
<span class="removed">- * under the terms of the GNU General Public License version 2 only, as</span>
<span class="removed">- * published by the Free Software Foundation.  Oracle designates this</span>
<span class="removed">- * particular file as subject to the "Classpath" exception as provided</span>
<span class="removed">- * by Oracle in the LICENSE file that accompanied this code.</span>
<span class="removed">- *</span>
<span class="removed">- * This code is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="removed">- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="removed">- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
<span class="removed">- * version 2 for more details (a copy is included in the LICENSE file that</span>
<span class="removed">- * accompanied this code).</span>
<span class="removed">- *</span>
<span class="removed">- * You should have received a copy of the GNU General Public License version</span>
<span class="removed">- * 2 along with this work; if not, write to the Free Software Foundation,</span>
<span class="removed">- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="removed">- *</span>
<span class="removed">- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA</span>
<span class="removed">- * or visit www.oracle.com if you need additional information or have any</span>
<span class="removed">- * questions.</span>
<span class="removed">- */</span>
<span class="removed">-package com.sun.glass.ui;</span>
<span class="removed">-</span>
<span class="removed">-import static com.sun.javafx.FXPermissions.CREATE_ROBOT_PERMISSION;</span>
<span class="removed">-import java.lang.annotation.Native;</span>
<span class="removed">-import java.nio.IntBuffer;</span>
<span class="removed">-</span>
<span class="removed">-public abstract class Robot {</span>
<span class="removed">-</span>
<span class="removed">-    @Native public static final int MOUSE_LEFT_BTN   = 1;</span>
<span class="removed">-    @Native public static final int MOUSE_RIGHT_BTN  = 2;</span>
<span class="removed">-    @Native public static final int MOUSE_MIDDLE_BTN = 4;</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract void _create();</span>
<span class="removed">-    protected Robot() {</span>
<span class="removed">-        // Ensure proper permission</span>
<span class="removed">-        final SecurityManager sm = System.getSecurityManager();</span>
<span class="removed">-        if (sm != null) {</span>
<span class="removed">-            sm.checkPermission(CREATE_ROBOT_PERMISSION);</span>
<span class="removed">-        }</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        _create();</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract void _destroy();</span>
<span class="removed">-    public void destroy() {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        _destroy();</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract void _keyPress(int code);</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Generate a key pressed event.</span>
<span class="removed">-     * @param code key code for this event</span>
<span class="removed">-     */</span>
<span class="removed">-    public void keyPress(int code) {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        _keyPress(code);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract void _keyRelease(int code);</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Generate a key released event.</span>
<span class="removed">-     *</span>
<span class="removed">-     * @param code key code for this event</span>
<span class="removed">-     */</span>
<span class="removed">-    public void keyRelease(int code) {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        _keyRelease(code);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract void _mouseMove(int x, int y);</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Generate a mouse moved event.</span>
<span class="removed">-     *</span>
<span class="removed">-     * @param x screen coordinate x</span>
<span class="removed">-     * @param y screen coordinate y</span>
<span class="removed">-     */</span>
<span class="removed">-    public void mouseMove(int x, int y) {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        _mouseMove(x, y);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract void _mousePress(int buttons);</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Generate a mouse press event with specified buttons mask.</span>
<span class="removed">-     *</span>
<span class="removed">-     * Up to 32-buttons mice are supported. Other buttons are inaccessible</span>
<span class="removed">-     * by the robot. Bits 0, 1, and 2 mean LEFT, RIGHT, and MIDDLE mouse buttons</span>
<span class="removed">-     * respectively.</span>
<span class="removed">-     *</span>
<span class="removed">-     * @param buttons buttons to have generated the event</span>
<span class="removed">-     */</span>
<span class="removed">-    public void mousePress(int buttons) {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        _mousePress(buttons);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract void _mouseRelease(int buttons);</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Generate a mouse release event with specified buttons mask.</span>
<span class="removed">-     *</span>
<span class="removed">-     * @param buttons buttons to have generated the event</span>
<span class="removed">-     */</span>
<span class="removed">-    public void mouseRelease(int buttons) {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        _mouseRelease(buttons);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract void _mouseWheel(int wheelAmt);</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Generate a mouse wheel event.</span>
<span class="removed">-     *</span>
<span class="removed">-     * @param wheelAmt amount the wheel has turned of wheel turning</span>
<span class="removed">-     */</span>
<span class="removed">-    public void mouseWheel(int wheelAmt) {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        _mouseWheel(wheelAmt);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract int _getMouseX();</span>
<span class="removed">-    public int getMouseX() {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        return _getMouseX();</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract int _getMouseY();</span>
<span class="removed">-    public int getMouseY() {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        return _getMouseY();</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected abstract int _getPixelColor(int x, int y);</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Returns pixel color at specified screen coordinates in IntARGB format.</span>
<span class="removed">-     */</span>
<span class="removed">-    public int getPixelColor(int x, int y) {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        return _getPixelColor(x, y);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    // Subclasses must override and implement at least one of the following two</span>
<span class="removed">-    // _getScreenCapture methods</span>
<span class="removed">-</span>
<span class="removed">-    protected void _getScreenCapture(int x, int y, int width, int height, int[] data) {</span>
<span class="removed">-        throw new UnsupportedOperationException("Not implementated in the base class");</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    protected Pixels _getScreenCapture(int x, int y, int width, int height, boolean isHiDPI) {</span>
<span class="removed">-        Screen mainScreen = Screen.getMainScreen();</span>
<span class="removed">-        float uiScaleX = mainScreen.getPlatformScaleX();</span>
<span class="removed">-        float uiScaleY = mainScreen.getPlatformScaleY();</span>
<span class="removed">-        int data[];</span>
<span class="removed">-        int dw, dh;</span>
<span class="removed">-        if (uiScaleX == 1.0f &amp;&amp; uiScaleY == 1.0f) {</span>
<span class="removed">-            data = new int[width * height];</span>
<span class="removed">-            _getScreenCapture(x, y, width, height, data);</span>
<span class="removed">-            dw = width;</span>
<span class="removed">-            dh = height;</span>
<span class="removed">-        } else {</span>
<span class="removed">-            int pminx = (int) Math.floor(x * uiScaleX);</span>
<span class="removed">-            int pminy = (int) Math.floor(y * uiScaleY);</span>
<span class="removed">-            int pmaxx = (int) Math.ceil((x + width) * uiScaleX);</span>
<span class="removed">-            int pmaxy = (int) Math.ceil((y + height) * uiScaleY);</span>
<span class="removed">-            int pwidth = pmaxx - pminx;</span>
<span class="removed">-            int pheight = pmaxy - pminy;</span>
<span class="removed">-            int tmpdata[] = new int[pwidth * pheight];</span>
<span class="removed">-            _getScreenCapture(pminx, pminy, pwidth, pheight, tmpdata);</span>
<span class="removed">-            if (isHiDPI) {</span>
<span class="removed">-                data = tmpdata;</span>
<span class="removed">-                dw = pwidth;</span>
<span class="removed">-                dh = pheight;</span>
<span class="removed">-            } else {</span>
<span class="removed">-                data = new int[width * height];</span>
<span class="removed">-                int index = 0;</span>
<span class="removed">-                for (int iy = 0; iy &lt; height; iy++) {</span>
<span class="removed">-                    float rely = ((y + iy + 0.5f) * uiScaleY) - (pminy + 0.5f);</span>
<span class="removed">-                    int irely = (int) Math.floor(rely);</span>
<span class="removed">-                    int fracty = (int) ((rely - irely) * 256);</span>
<span class="removed">-                    for (int ix = 0; ix &lt; width; ix++) {</span>
<span class="removed">-                        float relx = ((x + ix + 0.5f) * uiScaleX) - (pminx + 0.5f);</span>
<span class="removed">-                        int irelx = (int) Math.floor(relx);</span>
<span class="removed">-                        int fractx = (int) ((relx - irelx) * 256);</span>
<span class="removed">-                        data[index++] =</span>
<span class="removed">-                            interp(tmpdata, irelx, irely, pwidth, pheight, fractx, fracty);</span>
<span class="removed">-                    }</span>
<span class="removed">-                }</span>
<span class="removed">-                dw = width;</span>
<span class="removed">-                dh = height;</span>
<span class="removed">-            }</span>
<span class="removed">-        }</span>
<span class="removed">-        return Application.GetApplication().createPixels(dw, dh, IntBuffer.wrap(data));</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Returns a capture of the specified rectangular area of the screen.</span>
<span class="removed">-     *</span>
<span class="removed">-     * If {@code isHiDPI} argument is {@code true}, the returned Pixels object</span>
<span class="removed">-     * dimensions may differ from the requested {@code width} and {@code</span>
<span class="removed">-     * height} depending on how many physical pixels the area occupies on the</span>
<span class="removed">-     * screen.  E.g. in HiDPI mode on the Mac (aka Retina display) the pixels</span>
<span class="removed">-     * are doubled, and thus a screen capture of an area of size (10x10) pixels</span>
<span class="removed">-     * will result in a Pixels object with dimensions (20x20). Calling code</span>
<span class="removed">-     * should use the returned objects's getWidth() and getHeight() methods</span>
<span class="removed">-     * to determine the image size.</span>
<span class="removed">-     *</span>
<span class="removed">-     * If (@code isHiDPI) is {@code false}, the returned Pixels object is of</span>
<span class="removed">-     * the requested size. Note that in this case the image may be scaled in</span>
<span class="removed">-     * order to fit to the requested dimensions if running on a HiDPI display.</span>
<span class="removed">-     */</span>
<span class="removed">-    public Pixels getScreenCapture(int x, int y, int width, int height, boolean isHiDPI) {</span>
<span class="removed">-        Application.checkEventThread();</span>
<span class="removed">-        return _getScreenCapture(x, y, width, height, isHiDPI);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    /**</span>
<span class="removed">-     * Returns a capture of the specified area of the screen.</span>
<span class="removed">-     * It is equivalent to calling getScreenCapture(x, y, width, height, false),</span>
<span class="removed">-     * i.e. this method takes a "LowDPI" screen shot.</span>
<span class="removed">-     */</span>
<span class="removed">-    public Pixels getScreenCapture(int x, int y, int width, int height) {</span>
<span class="removed">-        return getScreenCapture(x, y, width, height, false);</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    private static int interp(int pixels[], int x, int y, int w, int h, int fractx1, int fracty1) {</span>
<span class="removed">-        int fractx0 = 256 - fractx1;</span>
<span class="removed">-        int fracty0 = 256 - fracty1;</span>
<span class="removed">-        int i = y * w + x;</span>
<span class="removed">-        int rgb00 = (x &lt; 0 || y &lt; 0 || x &gt;= w || y &gt;= h) ? 0 : pixels[i];</span>
<span class="removed">-        if (fracty1 == 0) {</span>
<span class="removed">-            // No interplation with pixels[y+1]</span>
<span class="removed">-            if (fractx1 == 0) {</span>
<span class="removed">-                // No interpolation with any neighbors</span>
<span class="removed">-                return rgb00;</span>
<span class="removed">-            }</span>
<span class="removed">-            int rgb10 = (y &lt; 0 || x+1 &gt;= w || y &gt;= h) ? 0 : pixels[i+1];</span>
<span class="removed">-            return interp(rgb00, rgb10, fractx0, fractx1);</span>
<span class="removed">-        } else if (fractx1 == 0) {</span>
<span class="removed">-            // No interpolation with pixels[x+1]</span>
<span class="removed">-            int rgb01 = (x &lt; 0 || x &gt;= w || y+1 &gt;= h) ? 0 : pixels[i+w];</span>
<span class="removed">-            return interp(rgb00, rgb01, fracty0, fracty1);</span>
<span class="removed">-        } else {</span>
<span class="removed">-            // All 4 neighbors must be interpolated</span>
<span class="removed">-            int rgb10 = (y &lt; 0 || x+1 &gt;= w || y &gt;= h) ? 0 : pixels[i+1];</span>
<span class="removed">-            int rgb01 = (x &lt; 0 || x &gt;= w || y+1 &gt;= h) ? 0 : pixels[i+w];</span>
<span class="removed">-            int rgb11 = (x+1 &gt;= w || y+1 &gt;= h) ? 0 : pixels[i+w+1];</span>
<span class="removed">-            return interp(interp(rgb00, rgb10, fractx0, fractx1),</span>
<span class="removed">-                          interp(rgb01, rgb11, fractx0, fractx1),</span>
<span class="removed">-                          fracty0, fracty1);</span>
<span class="removed">-        }</span>
<span class="removed">-    }</span>
<span class="removed">-</span>
<span class="removed">-    private static int interp(int rgb0, int rgb1, int fract0, int fract1) {</span>
<span class="removed">-        int a0 = (rgb0 &gt;&gt; 24) &amp; 0xff;</span>
<span class="removed">-        int r0 = (rgb0 &gt;&gt; 16) &amp; 0xff;</span>
<span class="removed">-        int g0 = (rgb0 &gt;&gt;  8) &amp; 0xff;</span>
<span class="removed">-        int b0 = (rgb0      ) &amp; 0xff;</span>
<span class="removed">-        int a1 = (rgb1 &gt;&gt; 24) &amp; 0xff;</span>
<span class="removed">-        int r1 = (rgb1 &gt;&gt; 16) &amp; 0xff;</span>
<span class="removed">-        int g1 = (rgb1 &gt;&gt;  8) &amp; 0xff;</span>
<span class="removed">-        int b1 = (rgb1      ) &amp; 0xff;</span>
<span class="removed">-        int a = (a0 * fract0 + a1 * fract1) &gt;&gt; 8;</span>
<span class="removed">-        int r = (r0 * fract0 + r1 * fract1) &gt;&gt; 8;</span>
<span class="removed">-        int g = (g0 * fract0 + g1 * fract1) &gt;&gt; 8;</span>
<span class="removed">-        int b = (b0 * fract0 + b1 * fract1) &gt;&gt; 8;</span>
<span class="removed">-        return (a &lt;&lt; 24) | (r &lt;&lt; 16) | (g &lt;&lt; 8) | b;</span>
<span class="removed">-    }</span>
<span class="removed">-}</span>
</pre>
<center><a href='../../../../../../../../../modules/javafx.graphics/src/main/java/com/sun/glass/ui/Application.java.udiff.html' target='_top'>&lt prev</a> <a href='../../../../../../../../../index.html' target='_top'>index</a> <a href='../../../../../../../../../modules/javafx.graphics/src/main/java/com/sun/glass/ui/gtk/GtkApplication.java.udiff.html' target='_top'>next &gt</a></center>
</body></html>

