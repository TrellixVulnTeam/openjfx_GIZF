<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
a.print { font-size: x-small; }

</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>openjfx Sdiff modules/javafx.graphics/src/main/native-glass/win </title>
</head><body id="SUNWwebrev">
<center><a href='../../../../../../modules/javafx.graphics/src/main/native-glass/mac/GlassRobot.m.sdiff.html' target='_top'>&lt prev</a> <a href='../../../../../../index.html' target='_top'>index</a> <a href='../../../../../../modules/javafx.graphics/src/test/addExports.sdiff.html' target='_top'>next &gt</a></center>
<h2>modules/javafx.graphics/src/main/native-glass/win/Robot.cpp</h2>
<a class="print" href="javascript:print()">Print this page</a>
<pre>rev <a href="https://bugs.openjdk.java.net/browse/JDK-10767">10767</a> : Move Robot to public API.</pre>

<table><tr valign="top">
<td><pre>

</pre><hr></hr><pre>
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 #include "common.h"
  27 #include "math.h"
  28 
  29 #include "KeyTable.h"
  30 
<span class="removed">  31 #include "com_sun_glass_ui_Robot.h"</span>
  32 #include "com_sun_glass_ui_win_WinRobot.h"
  33 #include "GlassScreen.h"
  34 
  35 
  36 static BOOL KeyEvent(JNIEnv *env, int code, bool isPress) {
  37     UINT vkey, modifiers;
  38 
  39     JavaKeyToWindowsKey(code, vkey, modifiers);
  40 
  41     if (!vkey) {
  42         return FALSE;
  43     } else {
  44         UINT scancode = ::MapVirtualKey(vkey, 0);
  45 
  46         INPUT keyInput = {0};
  47         keyInput.type = INPUT_KEYBOARD;
  48         keyInput.ki.wVk = vkey;
  49         keyInput.ki.wScan = scancode;
  50         keyInput.ki.time = 0;
  51         keyInput.ki.dwExtraInfo = 0;

</pre><hr></hr><pre>
 277  * Signature: (II)I
 278  */
 279 JNIEXPORT jint JNICALL Java_com_sun_glass_ui_win_WinRobot__1getPixelColor
 280     (JNIEnv *env, jobject jrobot, jint x, jint y)
 281 {
 282     jfloat fx = (jfloat) x + 0.5f;
 283     jfloat fy = (jfloat) y + 0.5f;
 284     GlassScreen::FX2Win(&amp;fx, &amp;fy);
 285     jint dx = (jint) fx;
 286     jint dy = (jint) fy;
 287 
 288     jint val = 0;
 289     //NOTE: we don't use the ::GetPixel() on the screen DC because it's not capable of
 290     //      getting the correct colors when non-opaque windows are present
 291     GetScreenCapture(dx, dy, 1, 1, &amp;val, 1, 1);
 292     return val;
 293 }
 294 
 295 /*
 296  * Class:     com_sun_glass_ui_win_WinRobot
<span class="changed"> 297  * Method:    _getScreenCapture</span>
 298  * Signature: (IIII[I;)V
 299  */
<span class="changed"> 300 JNIEXPORT void JNICALL Java_com_sun_glass_ui_win_WinRobot__1getScreenCapture</span>
 301     (JNIEnv *env, jobject jrobot, jint x, jint y, jint width, jint height, jintArray pixelArray)
 302 {
 303     int numPixels = width * height;
 304     int pixelDataSize = sizeof(jint) * numPixels;
 305     ASSERT(pixelDataSize &gt; 0 &amp;&amp; pixelDataSize % 4 == 0);
 306 
 307     jint * pixelData = (jint *)(new BYTE[pixelDataSize]);
 308 
 309     if (pixelData) {
 310         GetScreenCapture(x, y, width, height, pixelData, width, height);
 311 
 312         // copy pixels into Java array
 313         env-&gt;SetIntArrayRegion(pixelArray, 0, numPixels, pixelData);
 314         delete pixelData;
 315     }
 316 }
 317 
 318 void GetScreenCapture(jint x, jint y, jint devw, jint devh,
 319                       jint *pixelData, jint retw, jint reth)
 320 {

</pre><hr></hr>
</pre></td><td><pre>

</pre><hr></hr><pre>
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 #include "common.h"
  27 #include "math.h"
  28 
  29 #include "KeyTable.h"
  30 

  31 #include "com_sun_glass_ui_win_WinRobot.h"
  32 #include "GlassScreen.h"
  33 
  34 
  35 static BOOL KeyEvent(JNIEnv *env, int code, bool isPress) {
  36     UINT vkey, modifiers;
  37 
  38     JavaKeyToWindowsKey(code, vkey, modifiers);
  39 
  40     if (!vkey) {
  41         return FALSE;
  42     } else {
  43         UINT scancode = ::MapVirtualKey(vkey, 0);
  44 
  45         INPUT keyInput = {0};
  46         keyInput.type = INPUT_KEYBOARD;
  47         keyInput.ki.wVk = vkey;
  48         keyInput.ki.wScan = scancode;
  49         keyInput.ki.time = 0;
  50         keyInput.ki.dwExtraInfo = 0;

</pre><hr></hr><pre>
 276  * Signature: (II)I
 277  */
 278 JNIEXPORT jint JNICALL Java_com_sun_glass_ui_win_WinRobot__1getPixelColor
 279     (JNIEnv *env, jobject jrobot, jint x, jint y)
 280 {
 281     jfloat fx = (jfloat) x + 0.5f;
 282     jfloat fy = (jfloat) y + 0.5f;
 283     GlassScreen::FX2Win(&amp;fx, &amp;fy);
 284     jint dx = (jint) fx;
 285     jint dy = (jint) fy;
 286 
 287     jint val = 0;
 288     //NOTE: we don't use the ::GetPixel() on the screen DC because it's not capable of
 289     //      getting the correct colors when non-opaque windows are present
 290     GetScreenCapture(dx, dy, 1, 1, &amp;val, 1, 1);
 291     return val;
 292 }
 293 
 294 /*
 295  * Class:     com_sun_glass_ui_win_WinRobot
<span class="changed"> 296  * Method:    getScreenCapture</span>
 297  * Signature: (IIII[I;)V
 298  */
<span class="changed"> 299 JNIEXPORT void JNICALL Java_com_sun_glass_ui_win_WinRobot_getScreenCapture</span>
 300     (JNIEnv *env, jobject jrobot, jint x, jint y, jint width, jint height, jintArray pixelArray)
 301 {
 302     int numPixels = width * height;
 303     int pixelDataSize = sizeof(jint) * numPixels;
 304     ASSERT(pixelDataSize &gt; 0 &amp;&amp; pixelDataSize % 4 == 0);
 305 
 306     jint * pixelData = (jint *)(new BYTE[pixelDataSize]);
 307 
 308     if (pixelData) {
 309         GetScreenCapture(x, y, width, height, pixelData, width, height);
 310 
 311         // copy pixels into Java array
 312         env-&gt;SetIntArrayRegion(pixelArray, 0, numPixels, pixelData);
 313         delete pixelData;
 314     }
 315 }
 316 
 317 void GetScreenCapture(jint x, jint y, jint devw, jint devh,
 318                       jint *pixelData, jint retw, jint reth)
 319 {

</pre><hr></hr>
</pre></td>
</tr></table>
<center><a href='../../../../../../modules/javafx.graphics/src/main/native-glass/mac/GlassRobot.m.sdiff.html' target='_top'>&lt prev</a> <a href='../../../../../../index.html' target='_top'>index</a> <a href='../../../../../../modules/javafx.graphics/src/test/addExports.sdiff.html' target='_top'>next &gt</a></center>
</body></html>
